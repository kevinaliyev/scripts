
param(
  [switch] $IncludeBuiltIn,
  [switch] $IncludeModules,
  [switch] $ShowKind   # adds a KIND column (BuiltIn/User/Module:<name>)
)

$ErrorActionPreference = 'SilentlyContinue'

function TruncPad([string]$Text, [int]$Width) {
  if ($Width -lt 1) { return "" }
  if ($null -eq $Text) { $Text = "" }
  if ($Text.Length -gt $Width) {
    if ($Width -le 1) { return $Text.Substring(0, $Width) }
    return ($Text.Substring(0, $Width-1) + "â€¦")
  }
  return $Text.PadRight($Width)
}

function Get-BuiltInAliasNames {
  # Baseline: run pwsh without profiles. This avoids guessing.
  $pwsh = Join-Path $PSHOME 'pwsh.exe'
  if (-not (Test-Path -LiteralPath $pwsh)) { $pwsh = 'pwsh' }

  $out = & $pwsh -NoProfile -NonInteractive -Command "Get-Alias | ForEach-Object Name" 2>$null
  if (-not $out) { return @{} }

  $set = @{}
  foreach ($n in $out) { if ($n) { $set[$n] = $true } }
  return $set
}

$builtInSet = Get-BuiltInAliasNames

$rows = foreach ($a in (Get-Alias | Sort-Object Name)) {
  $isBuiltIn = $builtInSet.ContainsKey($a.Name)
  $kind =
    if ($isBuiltIn) { 'BuiltIn' }
    elseif ($a.Source) { 'Module:{0}' -f $a.Source }
    else { 'User/Session' }

  # Default behavior: show only User/Session (your stuff) unless flags include more
  $keep =
    ($kind -eq 'User/Session') -or
    ($IncludeModules -and $kind -like 'Module:*') -or
    ($IncludeBuiltIn -and $kind -eq 'BuiltIn')

  if (-not $keep) { continue }

  [pscustomobject]@{
    ALIAS = $a.Name
    VALUE = $a.Definition
    KIND  = $kind
  }
}

if (-not $rows -or $rows.Count -eq 0) {
  Write-Host "No aliases matched your filters." -ForegroundColor Yellow
  Write-Host "Try: .\aliaslist.ps1 -IncludeModules  or  .\aliaslist.ps1 -IncludeBuiltIn" -ForegroundColor DarkGray
  return
}

# Column widths
$wConsole = [Math]::Max(80, [Console]::WindowWidth)
$sep = " | "

$wAlias = 18
$wValue = 34
$wKind  = 20

if ($ShowKind) {
  $wRest = [Math]::Max(10, $wConsole - ($wAlias + $wValue + $wKind + ($sep.Length * 3)))
} else {
  $wRest = [Math]::Max(10, $wConsole - ($wAlias + $wValue + ($sep.Length * 2)))
}

# Header
Write-Host (TruncPad "ALIAS" $wAlias) -ForegroundColor Cyan -NoNewline
Write-Host $sep -ForegroundColor DarkGray -NoNewline
Write-Host (TruncPad "VALUE" $wValue) -ForegroundColor Yellow -NoNewline

if ($ShowKind) {
  Write-Host $sep -ForegroundColor DarkGray -NoNewline
  Write-Host (TruncPad "KIND" $wKind) -ForegroundColor Magenta
} else {
  Write-Host ""
}

# Divider
if ($ShowKind) {
  Write-Host (("-" * $wAlias) + $sep + ("-" * $wValue) + $sep + ("-" * $wKind)) -ForegroundColor DarkGray
} else {
  Write-Host (("-" * $wAlias) + $sep + ("-" * $wValue)) -ForegroundColor DarkGray
}

# Rows
foreach ($r in $rows) {
  $alias = TruncPad $r.ALIAS $wAlias
  $value = TruncPad $r.VALUE $wValue
  $kind  = TruncPad $r.KIND  $wKind

  Write-Host $alias -ForegroundColor Cyan -NoNewline
  Write-Host $sep   -ForegroundColor DarkGray -NoNewline
  Write-Host $value -ForegroundColor Yellow -NoNewline

  if ($ShowKind) {
    Write-Host $sep -ForegroundColor DarkGray -NoNewline
    $kc = if ($r.KIND -eq 'User/Session') { 'Green' } elseif ($r.KIND -eq 'BuiltIn') { 'DarkGray' } else { 'Magenta' }
    Write-Host $kind -ForegroundColor $kc
  } else {
    Write-Host ""
  }
}
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































